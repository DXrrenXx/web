<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>体育赛事对战查询</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f9fafb;
      color: #374151;
    }

    header {
      background-color: #1e293b;
      color: white;
      padding: 1rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    main {
      max-width: 64rem;
      margin: auto;
      padding: 2rem 1rem;
    }

    .text-center {
      text-align: center;
    }

    h1 {
      font-size: 1.25rem;
      font-weight: bold;
    }

    h2 {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    p {
      color: #4b5563;
    }

    .bg-white {
      background-color: white;
    }

    .rounded-lg {
      border-radius: 0.5rem;
    }

    .shadow-md {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .p-6 {
      padding: 1.5rem;
    }

    .mb-6 {
      margin-bottom: 1.5rem;
    }
    .mb-8 {
      margin-bottom: 2rem;
    }

    .flex {
      display: flex;
    }

    .flex-wrap {
      flex-wrap: wrap;
    }

    .gap-2 {
      gap: 0.5rem;
    }

    button {
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      font-weight: 500;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .sport-btn, .week-btn {
      background-color: #dbeafe;
      color: #1e40af;
    }
    .sport-btn:hover, .week-btn:hover:not(.active) {
      background-color: #bfdbfe;
    }
    .sport-btn.active, .week-btn.active {
      background-color: #2563eb;
      color: white;
    }

    .bg-gray-50 {
      background-color: #f9fafb;
    }

    .rounded-md {
      border-radius: 0.375rem;
    }

    .p-4 {
      padding: 1rem;
    }

    ul {
      list-style: none;
      padding-left: 0;
    }

    li {
      padding-bottom: 0.5rem;
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    li:last-child {
      border-bottom: none;
    }

    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .text-sm {
      font-size: 0.875rem;
    }

    .text-xs {
      font-size: 0.75rem;
    }

    .px-2 {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }

    .py-1 {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
    }


    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      text-align: left;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    thead tr {
      background-color: #f9fafb;
    }

    tbody tr:nth-child(even) {
      background-color: #f9fafb;
    }

    .mt-6 {
      margin-top: 1.5rem;
    }

    .bg-blue-50 {
      background-color: #eff6ff;
    }

    footer {
      background-color: #f3f4f6;
      padding: 1.5rem 1rem;
      text-align: center;
      font-size: 0.875rem;
      color: #4b5563;
    }
  </style>
</head>
<body>
  <header>
    <div class="container mx-auto px-4 py-3 text-center">
      <h1>天津经济技术开发区第一中学</h1>
    </div>
  </header>

  <main>
    <div class="text-center mb-8">
      <h2>体育赛事对战查询</h2>
      <p>查看赛程安排与班级积分排行榜</p>
    </div>

    <!-- 项目选择 -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">选择项目</h3>
      <div class="flex flex-wrap gap-2" id="sport-buttons">
        <!-- 动态生成项目按钮 -->
      </div>
    </div>

    <!-- 赛程查询 -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">赛程查询</h3>

      <div class="flex flex-wrap gap-2 mb-6" id="week-buttons">
        <!-- 动态生成按钮 -->
      </div>

      <div class="bg-gray-50 rounded-md p-4">
        <h4 class="font-semibold text-gray-800 mb-3" id="current-week-title">第1周赛程</h4>
        <ul id="match-list">
          <!-- 动态生成比赛列表 -->
        </ul>
      </div>
    </div>

    <!-- 积分排行榜 (保持不变) -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">班级积分排行榜</h3>

      <div class="overflow-x-auto">
        <!-- 保持 thead 不变 -->
        <table>
          <thead>
            <tr>
              <th>排名</th>
              <th>班级</th>
              <th>总积分</th>
            </tr>
          </thead>
          <tbody id="leaderboard-body">
            <!-- 动态生成排行榜 -->
          </tbody>
        </table>
      </div>

      <div class="mt-6 bg-blue-50 rounded-md p-4">
        <h4 class="font-medium text-gray-800 mb-2">积分规则说明</h4>
        <ul class="text-sm text-gray-700 space-y-1">
          <li>• 排名由管理员根据比赛情况手动录入总积分</li>
        </ul>
      </div>
    </div>
  </main>

  <footer>
    <p>© TFMS 比赛管理系统v3  Made by D_Xrren</p>
    <p class="mt-1">数据由管理员手动更新，每周三比赛后最晚周日更新比分</p>
  </footer>

  <script>
    // 从 data.json 加载所有项目赛程数据
    let allSportsData = {};
    let currentSport = "篮球"; // 默认项目
    let selectedWeek = 1;
    let themeConfig = {}; // 用于存储主题配置

    // 从 data2.json 加载班级积分数据
    let classPointsData = [];

    // 加载赛程数据
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        allSportsData = data.sports;
        themeConfig = data.theme || {}; // 读取主题配置

        // 加载积分数据
        return fetch('data2.json');
      })
      .then(response => response.json())
      .then(data2 => {
        classPointsData = data2.class_points;

        // 渲染
        renderSportButtons();
        renderWeekButtons();
        renderMatchList();
        renderLeaderboard(); // 渲染来自 data2.json 的排行榜
      })
      .catch(error => {
        console.error('加载数据失败:', error);
        alert('未能加载比赛数据，请确认 data.json 和 data2.json 文件存在且格式正确。');
      });

    // 渲染项目按钮
    function renderSportButtons() {
      const container = document.getElementById('sport-buttons');
      container.innerHTML = '';
      const sports = Object.keys(allSportsData);
      
      sports.forEach(sport => {
        const btn = document.createElement('button');
        btn.className = 'sport-btn';
        if (sport === currentSport) {
          btn.classList.add('active');
        }
        btn.textContent = sport;
        btn.onclick = () => {
          currentSport = sport;
          selectedWeek = 1; // 切换项目时重置到第1周
          renderSportButtons();
          renderWeekButtons();
          renderMatchList();
          // 注意：排行榜数据不变，所以不需要重新渲染
        };
        container.appendChild(btn);
      });
    }

    // 渲染周次按钮 (基于当前项目)
    function renderWeekButtons() {
      const container = document.getElementById('week-buttons');
      container.innerHTML = '';
      
      const currentSportSchedule = allSportsData[currentSport] || [];
      
      currentSportSchedule.forEach(schedule => {
        const btn = document.createElement('button');
        btn.className = 'week-btn';
        if (schedule.week === selectedWeek) {
          btn.classList.add('active');
        }
        btn.textContent = `第${schedule.week}周`;
        btn.onclick = () => {
          selectedWeek = schedule.week;
          renderWeekButtons();
          renderMatchList();
        };
        container.appendChild(btn);
      });
    }

    // 渲染当前项目和周次的比赛列表
    function renderMatchList() {
      const title = document.getElementById('current-week-title');
      title.textContent = `${currentSport} - 第${selectedWeek}周赛程`;

      const list = document.getElementById('match-list');
      list.innerHTML = '';

      const currentSportSchedule = allSportsData[currentSport] || [];
      const currentWeek = currentSportSchedule.find(s => s.week === selectedWeek);
      
      if (!currentWeek || !currentWeek.matches) {
          const li = document.createElement('li');
          li.textContent = '本周暂无比赛安排';
          list.appendChild(li);
          return;
      }

      currentWeek.matches.forEach(match => {
        const li = document.createElement('li');
        li.classList.add('border-b', 'pb-2', 'last:border-b-0');

        const matchDiv = document.createElement('div');
        matchDiv.classList.add('flex-between');

        const matchSpan = document.createElement('span');
        matchSpan.textContent = match.teams;
        matchDiv.appendChild(matchSpan);

        // --- 动态设置颜色 ---
        const resultSpan = document.createElement('span');
        resultSpan.classList.add('text-xs', 'px-2', 'py-1', 'rounded');
        resultSpan.textContent = match.result;

        let colorConfig;
        // 优先匹配具体的结果名称（如 "未开始"）
        if (themeConfig.colors && themeConfig.colors[match.result]) {
          colorConfig = themeConfig.colors[match.result];
        } else {
          // 如果没有具体匹配，则使用 "default" 配置
          colorConfig = themeConfig.colors?.default;
        }

        if (colorConfig) {
          resultSpan.style.backgroundColor = colorConfig.bg;
          resultSpan.style.color = colorConfig.text;
        } else {
          // 如果主题配置中都没有，则使用默认的灰色（可选）
          resultSpan.style.backgroundColor = '#e0e0e0';
          resultSpan.style.color = '#000000';
        }
        // --- 结束 ---

        matchDiv.appendChild(resultSpan);

        li.appendChild(matchDiv);

        const scoreDiv = document.createElement('div');
        scoreDiv.classList.add('text-sm', 'text-gray-500', 'mt-1');
        scoreDiv.textContent = `比分: ${match.score}`;
        li.appendChild(scoreDiv);

        list.appendChild(li);
      });
    }

    // 渲染排行榜（从 data2.json 读取数据，保持不变）
    function renderLeaderboard() {
      const tbody = document.getElementById('leaderboard-body');
      tbody.innerHTML = '';

      // 1. 按积分降序排序，积分相同时按班级名称升序排序 (支持中文数字排序)
      const sortedClasses = [...classPointsData].sort((a, b) => {
        if (b.points !== a.points) {
          return b.points - a.points; // 积分高的排前面
        } else {
          // 积分相同时，按班级名称（字符串）升序排序
          // 使用 localeCompare 支持中文排序，确保 "1班" < "10班"
          return a.className.localeCompare(b.className, 'zh-CN', { numeric: true, sensitivity: 'base' });
        }
      });

      // 2. 渲染表格
      sortedClasses.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${item.className}</td>
          <td>${item.points}</td>
        `;
        tbody.appendChild(tr);
      });
    }
  </script>
</body>
</html>